<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Planner + Grocery Optimizer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Calendar, ShoppingCart, DollarSign, TrendingUp, Plus, Trash2, Save, Download, Upload } = lucide;

        const MealPlannerApp = () => {
          const [meals, setMeals] = useState([]);
          const [recipes, setRecipes] = useState([
            {
              id: 1,
              name: "Chicken Stir Fry",
              ingredients: [
                { name: "Chicken breast", amount: 500, unit: "g", cost: 6.99 },
                { name: "Mixed vegetables", amount: 300, unit: "g", cost: 3.49 },
                { name: "Soy sauce", amount: 2, unit: "tbsp", cost: 0.30 },
                { name: "Rice", amount: 200, unit: "g", cost: 0.80 }
              ],
              servings: 4,
              calories: 450,
              protein: 35,
              carbs: 48,
              fat: 12
            },
            {
              id: 2,
              name: "Spaghetti Bolognese",
              ingredients: [
                { name: "Ground beef", amount: 400, unit: "g", cost: 5.99 },
                { name: "Spaghetti", amount: 400, unit: "g", cost: 1.29 },
                { name: "Tomato sauce", amount: 400, unit: "g", cost: 1.99 },
                { name: "Onion", amount: 1, unit: "piece", cost: 0.50 },
                { name: "Garlic", amount: 2, unit: "cloves", cost: 0.20 }
              ],
              servings: 4,
              calories: 520,
              protein: 28,
              carbs: 65,
              fat: 16
            },
            {
              id: 3,
              name: "Caesar Salad",
              ingredients: [
                { name: "Romaine lettuce", amount: 2, unit: "heads", cost: 2.99 },
                { name: "Caesar dressing", amount: 100, unit: "ml", cost: 2.49 },
                { name: "Parmesan cheese", amount: 50, unit: "g", cost: 1.99 },
                { name: "Croutons", amount: 100, unit: "g", cost: 1.49 },
                { name: "Chicken breast", amount: 300, unit: "g", cost: 4.19 }
              ],
              servings: 2,
              calories: 380,
              protein: 32,
              carbs: 18,
              fat: 22
            },
            {
              id: 4,
              name: "Vegetable Curry",
              ingredients: [
                { name: "Mixed vegetables", amount: 500, unit: "g", cost: 4.99 },
                { name: "Coconut milk", amount: 400, unit: "ml", cost: 1.99 },
                { name: "Curry paste", amount: 3, unit: "tbsp", cost: 1.20 },
                { name: "Rice", amount: 300, unit: "g", cost: 1.20 }
              ],
              servings: 4,
              calories: 420,
              protein: 8,
              carbs: 58,
              fat: 18
            }
          ]);
          
          const [customRecipe, setCustomRecipe] = useState({
            name: '',
            ingredients: [{ name: '', amount: '', unit: 'g', cost: '' }],
            servings: 1,
            calories: 0,
            protein: 0,
            carbs: 0,
            fat: 0
          });
          
          const [showAddRecipe, setShowAddRecipe] = useState(false);
          const [activeTab, setActiveTab] = useState('planner');
          
          const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
          const mealTypes = ['Breakfast', 'Lunch', 'Dinner', 'Snack'];

          useEffect(() => {
            const savedMeals = localStorage.getItem('mealPlans');
            const savedRecipes = localStorage.getItem('customRecipes');
            if (savedMeals) setMeals(JSON.parse(savedMeals));
            if (savedRecipes) setRecipes(JSON.parse(savedRecipes));
          }, []);

          const saveMeals = (newMeals) => {
            setMeals(newMeals);
            localStorage.setItem('mealPlans', JSON.stringify(newMeals));
          };

          const saveRecipes = (newRecipes) => {
            setRecipes(newRecipes);
            localStorage.setItem('customRecipes', JSON.stringify(newRecipes));
          };

          const addMeal = (day, mealType, recipe) => {
            const newMeal = {
              id: Date.now(),
              day,
              mealType,
              recipe
            };
            saveMeals([...meals, newMeal]);
          };

          const removeMeal = (id) => {
            saveMeals(meals.filter(meal => meal.id !== id));
          };

          const addIngredientToCustomRecipe = () => {
            setCustomRecipe({
              ...customRecipe,
              ingredients: [...customRecipe.ingredients, { name: '', amount: '', unit: 'g', cost: '' }]
            });
          };

          const updateCustomRecipeIngredient = (index, field, value) => {
            const newIngredients = [...customRecipe.ingredients];
            newIngredients[index][field] = value;
            setCustomRecipe({ ...customRecipe, ingredients: newIngredients });
          };

          const removeIngredientFromCustomRecipe = (index) => {
            const newIngredients = customRecipe.ingredients.filter((_, i) => i !== index);
            setCustomRecipe({ ...customRecipe, ingredients: newIngredients });
          };

          const saveCustomRecipe = () => {
            if (!customRecipe.name || customRecipe.ingredients.some(i => !i.name || !i.amount || !i.cost)) {
              alert('Please fill in all recipe fields');
              return;
            }
            
            const newRecipe = {
              id: Date.now(),
              ...customRecipe,
              ingredients: customRecipe.ingredients.map(ing => ({
                ...ing,
                amount: parseFloat(ing.amount),
                cost: parseFloat(ing.cost)
              })),
              servings: parseInt(customRecipe.servings),
              calories: parseInt(customRecipe.calories),
              protein: parseInt(customRecipe.protein),
              carbs: parseInt(customRecipe.carbs),
              fat: parseInt(customRecipe.fat)
            };
            
            saveRecipes([...recipes, newRecipe]);
            setCustomRecipe({
              name: '',
              ingredients: [{ name: '', amount: '', unit: 'g', cost: '' }],
              servings: 1,
              calories: 0,
              protein: 0,
              carbs: 0,
              fat: 0
            });
            setShowAddRecipe(false);
          };

          const generateGroceryList = () => {
            const groceryMap = {};
            
            meals.forEach(meal => {
              meal.recipe.ingredients.forEach(ingredient => {
                if (groceryMap[ingredient.name]) {
                  groceryMap[ingredient.name].amount += ingredient.amount;
                  groceryMap[ingredient.name].cost += ingredient.cost;
                } else {
                  groceryMap[ingredient.name] = {
                    amount: ingredient.amount,
                    unit: ingredient.unit,
                    cost: ingredient.cost
                  };
                }
              });
            });
            
            return Object.entries(groceryMap).map(([name, data]) => ({
              name,
              ...data
            }));
          };

          const calculateTotalCost = () => {
            return generateGroceryList().reduce((sum, item) => sum + item.cost, 0);
          };

          const calculateNutrition = () => {
            const totals = { calories: 0, protein: 0, carbs: 0, fat: 0 };
            
            meals.forEach(meal => {
              totals.calories += meal.recipe.calories;
              totals.protein += meal.recipe.protein;
              totals.carbs += meal.recipe.carbs;
              totals.fat += meal.recipe.fat;
            });
            
            return totals;
          };

          const exportData = () => {
            const data = {
              meals,
              recipes
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'meal-planner-data.json';
            a.click();
          };

          const importData = (event) => {
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                try {
                  const data = JSON.parse(e.target.result);
                  if (data.meals) saveMeals(data.meals);
                  if (data.recipes) saveRecipes(data.recipes);
                  alert('Data imported successfully!');
                } catch (error) {
                  alert('Error importing data. Please check the file format.');
                }
              };
              reader.readAsText(file);
            }
          };

          const groceryList = generateGroceryList();
          const totalCost = calculateTotalCost();
          const nutrition = calculateNutrition();

          return (
            <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-4">
              <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <h1 className="text-4xl font-bold text-gray-800 mb-2">üçΩÔ∏è Meal Planner + Grocery Optimizer</h1>
                  <p className="text-gray-600">Plan your week, save time and money on food</p>
                  
                  <div className="flex gap-2 mt-4">
                    <button
                      onClick={exportData}
                      className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"
                    >
                      <Download size={18} />
                      Export Data
                    </button>
                    <label className="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition cursor-pointer">
                      <Upload size={18} />
                      Import Data
                      <input type="file" accept=".json" onChange={importData} className="hidden" />
                    </label>
                  </div>
                </div>

                {/* Navigation Tabs */}
                <div className="bg-white rounded-lg shadow-lg mb-6">
                  <div className="flex border-b">
                    {['planner', 'grocery', 'recipes', 'nutrition'].map(tab => (
                      <button
                        key={tab}
                        onClick={() => setActiveTab(tab)}
                        className={`flex-1 px-6 py-4 font-semibold transition ${
                          activeTab === tab
                            ? 'bg-blue-500 text-white'
                            : 'text-gray-600 hover:bg-gray-100'
                        }`}
                      >
                        {tab === 'planner' && React.createElement(Calendar, { className: "inline mr-2", size: 20 })}
                        {tab === 'grocery' && React.createElement(ShoppingCart, { className: "inline mr-2", size: 20 })}
                        {tab === 'recipes' && React.createElement(Plus, { className: "inline mr-2", size: 20 })}
                        {tab === 'nutrition' && React.createElement(TrendingUp, { className: "inline mr-2", size: 20 })}
                        {tab.charAt(0).toUpperCase() + tab.slice(1)}
                      </button>
                    ))}
                  </div>
                </div>

                {/* Meal Planner Tab */}
                {activeTab === 'planner' && (
                  <div className="bg-white rounded-lg shadow-lg p-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Weekly Meal Plan</h2>
                    <div className="overflow-x-auto">
                      <table className="w-full border-collapse">
                        <thead>
                          <tr>
                            <th className="border p-3 bg-gray-100">Meal</th>
                            {daysOfWeek.map(day => (
                              <th key={day} className="border p-3 bg-gray-100">{day}</th>
                            ))}
                          </tr>
                        </thead>
                        <tbody>
                          {mealTypes.map(mealType => (
                            <tr key={mealType}>
                              <td className="border p-3 font-semibold bg-gray-50">{mealType}</td>
                              {daysOfWeek.map(day => {
                                const meal = meals.find(m => m.day === day && m.mealType === mealType);
                                return (
                                  <td key={`${day}-${mealType}`} className="border p-3">
                                    {meal ? (
                                      <div className="bg-blue-100 p-2 rounded relative group">
                                        <div className="font-medium text-sm">{meal.recipe.name}</div>
                                        <div className="text-xs text-gray-600">{meal.recipe.calories} cal</div>
                                        <button
                                          onClick={() => removeMeal(meal.id)}
                                          className="absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition"
                                        >
                                          {React.createElement(Trash2, { size: 14, className: "text-red-500" })}
                                        </button>
                                      </div>
                                    ) : (
                                      <select
                                        onChange={(e) => {
                                          const recipe = recipes.find(r => r.id === parseInt(e.target.value));
                                          if (recipe) addMeal(day, mealType, recipe);
                                          e.target.value = '';
                                        }}
                                        className="w-full p-2 border rounded text-sm"
                                        defaultValue=""
                                      >
                                        <option value="">+ Add meal</option>
                                        {recipes.map(recipe => (
                                          <option key={recipe.id} value={recipe.id}>{recipe.name}</option>
                                        ))}
                                      </select>
                                    )}
                                  </td>
                                );
                              })}
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {/* Grocery List Tab */}
                {activeTab === 'grocery' && (
                  <div className="bg-white rounded-lg shadow-lg p-6">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-2xl font-bold text-gray-800">Grocery List</h2>
                      <div className="flex items-center gap-2 text-2xl font-bold text-green-600">
                        {React.createElement(DollarSign, { size: 28 })}
                        {totalCost.toFixed(2)}
                      </div>
                    </div>
                    
                    {groceryList.length === 0 ? (
                      <p className="text-gray-500 text-center py-8">No meals planned yet. Add meals to generate your grocery list!</p>
                    ) : (
                      <div className="space-y-2">
                        {groceryList.map((item, index) => (
                          <div key={index} className="flex justify-between items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <div>
                              <span className="font-semibold">{item.name}</span>
                              <span className="text-gray-600 ml-2">
                                {item.amount} {item.unit}
                              </span>
                            </div>
                            <div className="text-green-600 font-semibold">
                              ${item.cost.toFixed(2)}
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                )}

                {/* Recipes Tab */}
                {activeTab === 'recipes' && (
                  <div className="bg-white rounded-lg shadow-lg p-6">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-2xl font-bold text-gray-800">Recipe Collection</h2>
                      <button
                        onClick={() => setShowAddRecipe(!showAddRecipe)}
                        className="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
                      >
                        {React.createElement(Plus, { size: 20 })}
                        Add Recipe
                      </button>
                    </div>

                    {showAddRecipe && (
                      <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                        <h3 className="font-bold text-lg mb-3">Create New Recipe</h3>
                        
                        <input
                          type="text"
                          placeholder="Recipe name"
                          value={customRecipe.name}
                          onChange={(e) => setCustomRecipe({ ...customRecipe, name: e.target.value })}
                          className="w-full p-2 border rounded mb-3"
                        />

                        <div className="grid grid-cols-2 gap-3 mb-3">
                          <input
                            type="number"
                            placeholder="Servings"
                            value={customRecipe.servings}
                            onChange={(e) => setCustomRecipe({ ...customRecipe, servings: e.target.value })}
                            className="p-2 border rounded"
                          />
                          <input
                            type="number"
                            placeholder="Calories"
                            value={customRecipe.calories}
                            onChange={(e) => setCustomRecipe({ ...customRecipe, calories: e.target.value })}
                            className="p-2 border rounded"
                          />
                          <input
                            type="number"
                            placeholder="Protein (g)"
                            value={customRecipe.protein}
                            onChange={(e) => setCustomRecipe({ ...customRecipe, protein: e.target.value })}
                            className="p-2 border rounded"
                          />
                          <input
                            type="number"
                            placeholder="Carbs (g)"
                            value={customRecipe.carbs}
                            onChange={(e) => setCustomRecipe({ ...customRecipe, carbs: e.target.value })}
                            className="p-2 border rounded"
                          />
                          <input
                            type="number"
                            placeholder="Fat (g)"
                            value={customRecipe.fat}
                            onChange={(e) => setCustomRecipe({ ...customRecipe, fat: e.target.value })}
                            className="p-2 border rounded"
                          />
                        </div>

                        <div className="mb-3">
                          <label className="font-semibold block mb-2">Ingredients:</label>
                          {customRecipe.ingredients.map((ingredient, index) => (
                            <div key={index} className="flex gap-2 mb-2">
                              <input
                                type="text"
                                placeholder="Ingredient name"
                                value={ingredient.name}
                                onChange={(e) => updateCustomRecipeIngredient(index, 'name', e.target.value)}
                                className="flex-1 p-2 border rounded"
                              />
                              <input
                                type="number"
                                placeholder="Amount"
                                value={ingredient.amount}
                                onChange={(e) => updateCustomRecipeIngredient(index, 'amount', e.target.value)}
                                className="w-24 p-2 border rounded"
                              />
                              <select
                                value={ingredient.unit}
                                onChange={(e) => updateCustomRecipeIngredient(index, 'unit', e.target.value)}
                                className="w-24 p-2 border rounded"
                              >
                                <option value="g">g</option>
                                <option value="ml">ml</option>
                                <option value="piece">piece</option>
                                <option value="tbsp">tbsp</option>
                                <option value="tsp">tsp</option>
                                <option value="cup">cup</option>
                              </select>
                              <input
                                type="number"
                                step="0.01"
                                placeholder="Cost"
                                value={ingredient.cost}
                                onChange={(e) => updateCustomRecipeIngredient(index, 'cost', e.target.value)}
                                className="w-24 p-2 border rounded"
                              />
                              <button
                                onClick={() => removeIngredientFromCustomRecipe(index)}
                                className="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                              >
                                {React.createElement(Trash2, { size: 16 })}
                              </button>
                            </div>
                          ))}
                          <button
                            onClick={addIngredientToCustomRecipe}
                            className="mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                          >
                            + Add Ingredient
                          </button>
                        </div>

                        <div className="flex gap-2">
                          <button
                            onClick={saveCustomRecipe}
                            className="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                          >
                            {React.createElement(Save, { size: 18 })}
                            Save Recipe
                          </button>
                          <button
                            onClick={() => setShowAddRecipe(false)}
                            className="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400"
                          >
                            Cancel
                          </button>
                        </div>
                      </div>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {recipes.map(recipe => (
                        <div key={recipe.id} className="border rounded-lg p-4 hover:shadow-lg transition">
                          <h3 className="font-bold text-lg mb-2">{recipe.name}</h3>
                          <div className="text-sm text-gray-600 mb-2">
                            Servings: {recipe.servings} | Cost: ${recipe.ingredients.reduce((sum, ing) => sum + ing.cost, 0).toFixed(2)}
                          </div>
                          <div className="text-sm mb-3">
                            <span className="inline-block bg-blue-100 px-2 py-1 rounded mr-2">{recipe.calories} cal</span>
                            <span className="inline-block bg-green-100 px-2 py-1 rounded mr-2">P: {recipe.protein}g</span>
                            <span className="inline-block bg-yellow-100 px-2 py-1 rounded mr-2">C: {recipe.carbs}g</span>
                            <span className="inline-block bg-red-100 px-2 py-1 rounded">F: {recipe.fat}g</span>
                          </div>
                          <details className="text-sm">
                            <summary className="cursor-pointer font-semibold text-blue-600">Ingredients</summary>
                            <ul className="mt-2 space-y-1">
                              {recipe.ingredients.map((ing, index) => (
                                <li key={index} className="pl-4">
                                  ‚Ä¢ {ing.name}: {ing.amount} {ing.unit} (${ing.cost.toFixed(2)})
                                </li>
                              ))}
                            </ul>
                          </details>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Nutrition Tab */}
                {activeTab === 'nutrition' && (
                  <div className="bg-white rounded-lg shadow-lg p-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Weekly Nutrition Overview</h2>
                    
                    {meals.length === 0 ? (
                      <p className="text-gray-500 text-center py-8">No meals planned yet. Add meals to see nutrition stats!</p>
                    ) : (
                      <div className="space-y-6">
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                          <div className="bg-blue-100 p-6 rounded-lg text-center">
                            <div className="text-3xl font-bold text-blue-600">{nutrition.calories}</div>
                            <div className="text-gray-600">Total Calories</div>
                          </div>
                          <div className="bg-green-100 p-6 rounded-lg text-center">
                            <div className="text-3xl font-bold text-green-600">{nutrition.protein}g</div>
                            <div className="text-gray-600">Protein</div>
                          </div>
                          <div className="bg-yellow-100 p-6 rounded-lg text-center">
                            <div className="text-3xl font-bold text-yellow-600">{nutrition.carbs}g</div>
                            <div className="text-gray-600">Carbs</div>
                          </div>
                          <div className="bg-red-100 p-6 rounded-lg text-center">
                            <div className="text-3xl font-bold text-red-600">{nutrition.fat}g</div>
                            <div className="text-gray-600">Fat</div>
                          </div>
                        </div>

                        <div className="bg-gray-50 p-4 rounded-lg">
                          <h3 className="font-bold mb-3">Daily Average (based on {meals.length} meals)</h3>
                          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                              <div className="font-semibold">{Math.round(nutrition.calories / 7)} cal/day</div>
                              <div className="text-sm text-gray-600">Calories</div>
                            </div>
                            <div>
                              <div className="font-semibold">{Math.round(nutrition.protein / 7)}g/day</div>
                              <div className="text-sm text-gray-600">Protein</div>
                            </div>
                            <div>
                              <div className="font-semibold">{Math.round(nutrition.carbs / 7)}g/day</div>
                              <div className="text-sm text-gray-600">Carbs</div>
                            </div>
                            <div>
                              <div className="font-semibold">{Math.round(nutrition.fat / 7)}g/day</div>
                              <div className="text-sm text-gray-600">Fat</div>
                            </div>
                          </div>
                        </div>

                        <div className="bg-gray-50 p-4 rounded-lg">
                          <h3 className="font-bold mb-3">Cost Efficiency</h3>
                          <div className="text-2xl font-bold text-green-600 mb-2">${totalCost.toFixed(2)}/week</div>
                          <div className="text-gray-600">Average ${(totalCost / 7).toFixed(2)}/day</div>
                          <div className="text-sm text-gray-500 mt-2">
                            Cost per calorie: ${((totalCost / nutrition.calories) * 100).toFixed(2)} per 100 cal
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          );
        };

        // Initialize lucide icons
        lucide.createIcons();
        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(MealPlannerApp));
    </script>
</body>
</html>
