<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Planner + Digital Cookbook</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #0f172a;
        }
        .instructions-text {
            white-space: pre-wrap;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const MealPlannerApp = () => {
          const APP_VERSION = '2.6.0';
          
          const defaultRecipes = []; // Start with empty recipes - user will import JSON
          
          const [meals, setMeals] = useState([]);
          const [recipes, setRecipes] = useState(defaultRecipes);
          
          const [customRecipe, setCustomRecipe] = useState({
            name: '',
            url: '',
            instructions: '',
            notes: '',
            ingredients: [{ name: '', amount: '', unit: 'g' }],
            servings: 1,
            calories: 0,
            protein: 0,
            carbs: 0,
            fat: 0,
            prepTime: '',
            cookTime: ''
          });
          
          const [showAddRecipe, setShowAddRecipe] = useState(false);
          const [selectedRecipe, setSelectedRecipe] = useState(null);
          const [activeTab, setActiveTab] = useState('planner');
          const [pantryItems, setPantryItems] = useState([]);
          const [newPantryItem, setNewPantryItem] = useState('');
          const [searchQuery, setSearchQuery] = useState('');
          const [checkedGroceryItems, setCheckedGroceryItems] = useState({});
          const [mealHistory, setMealHistory] = useState([]);
          const [pantryStaples, setPantryStaples] = useState([]);
          const [filterPantryFromGrocery, setFilterPantryFromGrocery] = useState(true);
          const [cookMode, setCookMode] = useState(false);
          const [wakeLock, setWakeLock] = useState(null);
          
          const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
          const mealTypes = ['Breakfast', 'Lunch', 'Dinner', 'Kids'];

          // Filter recipes based on search query
          const filteredRecipes = useMemo(() => {
            if (!searchQuery.trim()) return recipes;
            
            const query = searchQuery.toLowerCase();
            return recipes.filter(recipe => 
              recipe.name.toLowerCase().includes(query) ||
              (recipe.instructions && recipe.instructions.toLowerCase().includes(query)) ||
              recipe.ingredients.some(ing => ing.name.toLowerCase().includes(query))
            );
          }, [recipes, searchQuery]);

          useEffect(() => {
            const savedMeals = localStorage.getItem('mealPlans');
            const savedRecipes = localStorage.getItem('customRecipes');
            const savedPantry = localStorage.getItem('pantryItems');
            const savedChecked = localStorage.getItem('checkedGroceryItems');
            const savedHistory = localStorage.getItem('mealHistory');
            const savedStaples = localStorage.getItem('pantryStaples');
            const savedFilter = localStorage.getItem('filterPantryFromGrocery');
            
            if (savedMeals) setMeals(JSON.parse(savedMeals));
            if (savedRecipes) setRecipes(JSON.parse(savedRecipes));
            if (savedPantry) setPantryItems(JSON.parse(savedPantry));
            if (savedChecked) setCheckedGroceryItems(JSON.parse(savedChecked));
            if (savedHistory) setMealHistory(JSON.parse(savedHistory));
            if (savedStaples) setPantryStaples(JSON.parse(savedStaples));
            if (savedFilter !== null) setFilterPantryFromGrocery(JSON.parse(savedFilter));
          }, []);

          const saveMeals = (newMeals) => {
            setMeals(newMeals);
            localStorage.setItem('mealPlans', JSON.stringify(newMeals));
          };

          const saveRecipes = (newRecipes) => {
            setRecipes(newRecipes);
            localStorage.setItem('customRecipes', JSON.stringify(newRecipes));
          };

          const savePantry = (newPantry) => {
            setPantryItems(newPantry);
            localStorage.setItem('pantryItems', JSON.stringify(newPantry));
          };

          const addMeal = (day, mealType, recipeOrText) => {
            // If it's a custom text entry (not a recipe object), create a simple meal object
            const mealData = typeof recipeOrText === 'string' 
              ? { 
                  id: Date.now(), 
                  day, 
                  mealType, 
                  customName: recipeOrText,
                  isCustom: true
                }
              : { 
                  id: Date.now(), 
                  day, 
                  mealType, 
                  recipe: recipeOrText,
                  isCustom: false
                };
            
            saveMeals([...meals, mealData]);
          };

          const removeMeal = (id) => {
            saveMeals(meals.filter(meal => meal.id !== id));
          };

          const toggleCookMode = async () => {
            if (!cookMode) {
              // Enable cook mode - request wake lock
              try {
                if ('wakeLock' in navigator) {
                  const lock = await navigator.wakeLock.request('screen');
                  setWakeLock(lock);
                  setCookMode(true);
                  
                  // Handle wake lock release (e.g., if user switches tabs)
                  lock.addEventListener('release', () => {
                    console.log('Wake lock released');
                  });
                } else {
                  alert('Wake Lock not supported on this device, but Cook Mode enabled anyway for larger text.');
                  setCookMode(true);
                }
              } catch (err) {
                console.error('Wake lock error:', err);
                alert('Could not prevent sleep, but Cook Mode enabled for larger text.');
                setCookMode(true);
              }
            } else {
              // Disable cook mode - release wake lock
              if (wakeLock) {
                wakeLock.release();
                setWakeLock(null);
              }
              setCookMode(false);
            }
          };

          const addIngredientToCustomRecipe = () => {
            setCustomRecipe({
              ...customRecipe,
              ingredients: [...customRecipe.ingredients, { name: '', amount: '', unit: 'g' }]
            });
          };

          const updateCustomRecipeIngredient = (index, field, value) => {
            const newIngredients = [...customRecipe.ingredients];
            newIngredients[index][field] = value;
            setCustomRecipe({ ...customRecipe, ingredients: newIngredients });
          };

          const removeIngredientFromCustomRecipe = (index) => {
            setCustomRecipe({ ...customRecipe, ingredients: customRecipe.ingredients.filter((_, i) => i !== index) });
          };

          const saveCustomRecipe = () => {
            if (!customRecipe.name) {
              alert('Please fill in recipe name');
              return;
            }
            
            // Filter out completely empty ingredients (both name and amount empty)
            // But allow ingredients with just a name (amount optional)
            const validIngredients = customRecipe.ingredients.filter(i => i.name && i.name.trim());
            
            const newRecipe = {
              id: Date.now(),
              ...customRecipe,
              ingredients: validIngredients.map(ing => ({
                ...ing,
                amount: ing.amount ? parseFloat(ing.amount) : 0,
                unit: ing.amount ? ing.unit : ''
              })),
              servings: parseInt(customRecipe.servings) || 1,
              calories: parseInt(customRecipe.calories) || 0,
              protein: parseInt(customRecipe.protein) || 0,
              carbs: parseInt(customRecipe.carbs) || 0,
              fat: parseInt(customRecipe.fat) || 0
            };
            
            saveRecipes([...recipes, newRecipe]);
            setCustomRecipe({
              name: '',
              url: '',
              instructions: '',
              notes: '',
              ingredients: [{ name: '', amount: '', unit: 'g' }],
              servings: 1,
              calories: 0,
              protein: 0,
              carbs: 0,
              fat: 0,
              prepTime: '',
              cookTime: ''
            });
            setShowAddRecipe(false);
          };

          const deleteRecipe = (recipeId) => {
            if (confirm('Are you sure you want to delete this recipe?')) {
              saveRecipes(recipes.filter(r => r.id !== recipeId));
              if (selectedRecipe?.id === recipeId) {
                setSelectedRecipe(null);
              }
            }
          };

          const editRecipe = (recipe) => {
            setCustomRecipe({
              ...recipe,
              ingredients: recipe.ingredients.map(ing => ({ ...ing }))
            });
            setShowAddRecipe(true);
            setSelectedRecipe(null);
            // Delete the old version
            saveRecipes(recipes.filter(r => r.id !== recipe.id));
          };

          const generateGroceryList = () => {
            const groceryMap = {};
            
            // Helper function to normalize ingredient names for smart matching
            const normalizeIngredient = (name) => {
              return name.toLowerCase()
                .replace(/\b(boneless|skinless|bone-in|skin-on|fresh|frozen|raw|cooked|large|small|medium|diced|chopped|minced|sliced)\b/g, '')
                .replace(/\s+/g, ' ')
                .trim();
            };
            
            meals.forEach(meal => {
              // Skip custom meals (they don't have recipes/ingredients)
              if (meal.isCustom) return;
              
              meal.recipe.ingredients.forEach(ingredient => {
                const normalized = normalizeIngredient(ingredient.name);
                
                // Look for existing similar ingredient
                let matchedKey = null;
                for (let existingName in groceryMap) {
                  if (normalizeIngredient(existingName) === normalized) {
                    matchedKey = existingName;
                    break;
                  }
                }
                
                if (matchedKey) {
                  // Found a match - combine them
                  const existing = groceryMap[matchedKey];
                  
                  // Add recipe to the list
                  if (!existing.recipes.includes(meal.recipe.name)) {
                    existing.recipes.push(meal.recipe.name);
                  }
                  
                  // Combine amounts if same unit
                  if (existing.unit === ingredient.unit) {
                    existing.amount += ingredient.amount;
                  } else {
                    // Different units - add as separate detail
                    existing.details.push({
                      amount: ingredient.amount,
                      unit: ingredient.unit,
                      from: meal.recipe.name
                    });
                  }
                } else {
                  // New ingredient
                  groceryMap[ingredient.name] = {
                    amount: ingredient.amount,
                    unit: ingredient.unit,
                    recipes: [meal.recipe.name],
                    details: []
                  };
                }
              });
            });
            
            // Convert to array
            const list = Object.entries(groceryMap).map(([name, data]) => ({
              name,
              amount: data.amount,
              unit: data.unit,
              recipes: data.recipes,
              details: data.details
            }));
            
            // Filter out pantry staples if enabled
            if (filterPantryFromGrocery && pantryStaples.length > 0) {
              const normalizeForComparison = (str) => str.toLowerCase().trim();
              const stapleLookup = new Set(pantryStaples.map(normalizeForComparison));
              
              return list.filter(item => {
                const itemName = normalizeForComparison(item.name);
                return !stapleLookup.has(itemName);
              });
            }
            
            return list;
          };

          const calculateNutrition = () => {
            const totals = { calories: 0, protein: 0, carbs: 0, fat: 0 };
            meals.forEach(meal => {
              // Skip custom meals (they don't have nutrition data)
              if (meal.isCustom) return;
              
              totals.calories += meal.recipe.calories || 0;
              totals.protein += meal.recipe.protein || 0;
              totals.carbs += meal.recipe.carbs || 0;
              totals.fat += meal.recipe.fat || 0;
            });
            return totals;
          };

          const findMatchingRecipes = () => {
            const pantrySet = new Set(pantryItems.map(item => item.toLowerCase().trim()));
            
            return recipes.map(recipe => {
              const recipeIngredients = recipe.ingredients.map(ing => ing.name.toLowerCase());
              const matchingIngredients = recipeIngredients.filter(ing => pantrySet.has(ing));
              const missingIngredients = recipe.ingredients.filter(
                ing => !pantrySet.has(ing.name.toLowerCase())
              );
              
              const matchPercentage = (matchingIngredients.length / recipeIngredients.length) * 100;
              
              return {
                recipe,
                matchPercentage,
                matchingCount: matchingIngredients.length,
                missingIngredients,
                missingCount: missingIngredients.length
              };
            })
            .filter(result => result.matchPercentage > 0)
            .sort((a, b) => {
              if (a.missingCount !== b.missingCount) {
                return a.missingCount - b.missingCount;
              }
              return b.matchPercentage - a.matchPercentage;
            });
          };

          const addPantryItem = () => {
            if (newPantryItem.trim()) {
              savePantry([...pantryItems, newPantryItem.trim()]);
              setNewPantryItem('');
            }
          };

          const removePantryItem = (index) => {
            savePantry(pantryItems.filter((_, i) => i !== index));
          };

          const toggleGroceryCheck = (itemKey) => {
            const newChecked = { ...checkedGroceryItems, [itemKey]: !checkedGroceryItems[itemKey] };
            setCheckedGroceryItems(newChecked);
            localStorage.setItem('checkedGroceryItems', JSON.stringify(newChecked));
          };

          const clearAllChecks = () => {
            setCheckedGroceryItems({});
            localStorage.removeItem('checkedGroceryItems');
          };

          const saveWeekToHistory = () => {
            if (meals.length === 0) {
              alert('No meals to save to history!');
              return;
            }
            
            const weekName = prompt('Name this week (e.g., "Week of Jan 6" or "Holiday Week"):');
            if (!weekName) return;
            
            const historyEntry = {
              id: Date.now(),
              name: weekName,
              date: new Date().toISOString(),
              meals: JSON.parse(JSON.stringify(meals)) // Deep copy
            };
            
            const newHistory = [historyEntry, ...mealHistory];
            setMealHistory(newHistory);
            localStorage.setItem('mealHistory', JSON.stringify(newHistory));
            
            alert(`Week saved to history as "${weekName}"!`);
          };

          const loadWeekFromHistory = (historyEntry) => {
            if (meals.length > 0) {
              if (!confirm('This will replace your current meal plan. Continue?')) {
                return;
              }
            }
            
            saveMeals(historyEntry.meals);
            setActiveTab('planner');
            alert(`Loaded "${historyEntry.name}" into your planner!`);
          };

          const deleteHistoryEntry = (id) => {
            if (!confirm('Delete this week from history?')) return;
            
            const newHistory = mealHistory.filter(entry => entry.id !== id);
            setMealHistory(newHistory);
            localStorage.setItem('mealHistory', JSON.stringify(newHistory));
          };

          const exportGroceryListToReminders = () => {
            const groceryList = generateGroceryList();
            
            if (groceryList.length === 0) {
              alert('No items in grocery list!');
              return;
            }
            
            // Create clean line-by-line format (ONLY item name and amount, nothing else)
            let textContent = '';
            groceryList.forEach(item => {
              const amount = item.amount > 0 ? ` - ${item.amount} ${item.unit}` : '';
              textContent += `${item.name}${amount}\n`;
            });
            
            // Remove trailing newline to avoid empty reminder
            textContent = textContent.trim();
            
            // Copy to clipboard
            navigator.clipboard.writeText(textContent).then(() => {
              alert(`‚úÖ Copied ${groceryList.length} items!

Ready to import to Reminders!
Run your "Import Grocery List" shortcut now.`);
            }).catch(() => {
              alert('Could not copy to clipboard. Please try again.');
            });
          };

          const exportData = () => {
            const data = { meals, recipes, pantryItems };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'meal-planner-data.json';
            a.click();
          };

          const importData = (event) => {
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                try {
                  const data = JSON.parse(e.target.result);
                  if (data.meals) saveMeals(data.meals);
                  if (data.recipes) saveRecipes(data.recipes);
                  if (data.pantryItems) savePantry(data.pantryItems);
                  alert('Data imported successfully!');
                } catch (error) {
                  alert('Error importing data. Please check the file format.');
                }
              };
              reader.readAsText(file);
            }
          };

          const groceryList = generateGroceryList();
          const nutrition = calculateNutrition();
          const matchingRecipes = useMemo(() => findMatchingRecipes(), [pantryItems, recipes]);

          return (
            <div className="min-h-screen bg-slate-900 p-4">
              <div className="max-w-7xl mx-auto">
                <div className="bg-slate-800 rounded-lg shadow-lg p-6 mb-6 border border-slate-700">
                  <div className="flex justify-between items-start">
                    <div>
                      <h1 className="text-4xl font-bold text-white mb-2">üçΩÔ∏è Meal Planner + Digital Cookbook</h1>
                      <p className="text-slate-400">Plan your week and organize your favorite recipes</p>
                    </div>
                    <div className="text-right">
                      <div className="text-xs text-slate-400 bg-slate-700 px-3 py-1 rounded-full">
                        v2.6.0
                      </div>
                    </div>
                  </div>
                  
                  <div className="flex gap-2 mt-4">
                    <button onClick={exportData} className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                      ‚Üì Export Data
                    </button>
                    <label className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition cursor-pointer">
                      ‚Üë Import Data
                      <input type="file" accept=".json" onChange={importData} className="hidden" />
                    </label>
                  </div>
                </div>

                <div className="bg-slate-800 rounded-lg shadow-lg mb-6 border border-slate-700">
                  <div className="flex flex-wrap border-b border-slate-700">
                    {[
                      { key: 'planner', label: 'üìÖ Planner' },
                      { key: 'cookbook', label: 'üìñ Cookbook' },
                      { key: 'grocery', label: 'üõí Grocery' },
                      { key: 'history', label: 'üìú History' },
                      { key: 'pantry', label: 'üí° Smart Match' },
                      { key: 'nutrition', label: 'üìä Nutrition' },
                      { key: 'help', label: '‚ùì Help' }
                    ].map(({ key, label }) => (
                      <button
                        key={key}
                        onClick={() => setActiveTab(key)}
                        className={`flex-1 px-4 py-4 font-semibold transition min-w-[120px] ${
                          activeTab === key ? 'bg-blue-600 text-white' : 'text-slate-300 hover:bg-slate-700'
                        }`}
                      >
                        {label}
                      </button>
                    ))}
                  </div>
                </div>

                {activeTab === 'planner' && (
                  <div className="bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-2xl font-bold text-white">Weekly Meal Plan</h2>
                      {meals.length > 0 && (
                        <div className="flex gap-2">
                          <button
                            onClick={saveWeekToHistory}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                          >
                            üíæ Save to History
                          </button>
                          <button
                            onClick={() => {
                              if (confirm('Are you sure you want to clear all meals from your weekly plan?')) {
                                saveMeals([]);
                              }
                            }}
                            className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition"
                          >
                            üóëÔ∏è Clear All
                          </button>
                        </div>
                      )}
                    </div>
                    <div className="overflow-x-auto">
                      <table className="w-full border-collapse">
                        <thead>
                          <tr>
                            <th className="border border-slate-600 p-3 bg-slate-700 text-white">Meal</th>
                            {daysOfWeek.map(day => (
                              <th key={day} className="border border-slate-600 p-3 bg-slate-700 text-white">{day}</th>
                            ))}
                          </tr>
                        </thead>
                        <tbody>
                          {mealTypes.map(mealType => (
                            <tr key={mealType}>
                              <td className="border border-slate-600 p-3 font-semibold bg-slate-750 text-white">{mealType}</td>
                              {daysOfWeek.map(day => {
                                const meal = meals.find(m => m.day === day && m.mealType === mealType);
                                return (
                                  <td key={`${day}-${mealType}`} className="border border-slate-600 p-3 bg-slate-800">
                                    {meal ? (
                                      <div className={`p-2 rounded relative group ${meal.isCustom ? 'bg-slate-700' : 'bg-blue-900'}`}>
                                        <div className="font-medium text-sm text-white">
                                          {meal.isCustom ? meal.customName : meal.recipe.name}
                                        </div>
                                        {!meal.isCustom && meal.recipe.calories > 0 && (
                                          <div className="text-xs text-slate-300">{meal.recipe.calories} cal</div>
                                        )}
                                        <button
                                          onClick={() => removeMeal(meal.id)}
                                          className="absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition text-red-400 font-bold text-lg hover:text-red-300"
                                        >
                                          √ó
                                        </button>
                                      </div>
                                    ) : (
                                      <div>
                                        <input
                                          type="text"
                                          list={`recipes-${day}-${mealType}`}
                                          placeholder="Type or select..."
                                          onKeyDown={(e) => {
                                            if (e.key === 'Enter' && e.target.value.trim()) {
                                              const selectedRecipe = recipes.find(r => r.name === e.target.value);
                                              if (selectedRecipe) {
                                                addMeal(day, mealType, selectedRecipe);
                                              } else {
                                                addMeal(day, mealType, e.target.value.trim());
                                              }
                                              e.target.value = '';
                                            }
                                          }}
                                          onBlur={(e) => {
                                            if (e.target.value.trim()) {
                                              const selectedRecipe = recipes.find(r => r.name === e.target.value);
                                              if (selectedRecipe) {
                                                addMeal(day, mealType, selectedRecipe);
                                              } else {
                                                addMeal(day, mealType, e.target.value.trim());
                                              }
                                              e.target.value = '';
                                            }
                                          }}
                                          className="w-full p-2 border border-slate-600 rounded text-sm bg-slate-700 text-white placeholder-slate-400"
                                        />
                                        <datalist id={`recipes-${day}-${mealType}`}>
                                          <option value="Leftovers" />
                                          <option value="Eating Out" />
                                          <option value="Frozen Pizza" />
                                          <option value="Takeout" />
                                          {recipes.map(recipe => (
                                            <option key={recipe.id} value={recipe.name} />
                                          ))}
                                        </datalist>
                                      </div>
                                    )}
                                  </td>
                                );
                              })}
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {activeTab === 'cookbook' && (
                  <div className="bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-2xl font-bold text-white">Digital Cookbook</h2>
                      <button
                        onClick={() => {
                          setShowAddRecipe(!showAddRecipe);
                          setSelectedRecipe(null);
                        }}
                        className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                      >
                        + Add Recipe
                      </button>
                    </div>

                    {/* Search Bar */}
                    <div className="mb-4">
                      <input
                        type="text"
                        placeholder="üîç Search recipes by name, ingredient, or instructions..."
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        className="w-full p-3 border border-slate-600 rounded-lg bg-slate-700 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      {searchQuery && (
                        <div className="mt-2 text-sm text-slate-400">
                          Found {filteredRecipes.length} recipe{filteredRecipes.length !== 1 ? 's' : ''}
                        </div>
                      )}
                    </div>

                    {showAddRecipe && (
                      <div className="mb-6 p-4 bg-slate-700 rounded-lg border border-slate-600">
                        <h3 className="font-bold text-lg mb-3 text-white">Create New Recipe</h3>
                        
                        <input
                          type="text"
                          placeholder="Recipe name *"
                          value={customRecipe.name}
                          onChange={(e) => setCustomRecipe({ ...customRecipe, name: e.target.value })}
                          className="w-full p-2 border border-slate-600 rounded mb-3 bg-slate-800 text-white placeholder-slate-400"
                        />

                        <input
                          type="url"
                          placeholder="Recipe URL (optional - link to your Excel or website)"
                          value={customRecipe.url}
                          onChange={(e) => setCustomRecipe({ ...customRecipe, url: e.target.value })}
                          className="w-full p-2 border border-slate-600 rounded mb-3 bg-slate-800 text-white placeholder-slate-400"
                        />

                        <div className="grid grid-cols-2 gap-3 mb-3">
                          <div>
                            <label className="block text-sm font-semibold mb-1 text-slate-300">Servings</label>
                            <input type="number" placeholder="e.g., 4" value={customRecipe.servings} onChange={(e) => setCustomRecipe({ ...customRecipe, servings: e.target.value })} className="w-full p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400" />
                          </div>
                          <div>
                            <label className="block text-sm font-semibold mb-1 text-slate-300">Prep Time</label>
                            <input type="text" placeholder="e.g., 10 min" value={customRecipe.prepTime} onChange={(e) => setCustomRecipe({ ...customRecipe, prepTime: e.target.value })} className="w-full p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400" />
                          </div>
                          <div>
                            <label className="block text-sm font-semibold mb-1 text-slate-300">Cook Time</label>
                            <input type="text" placeholder="e.g., 20 min" value={customRecipe.cookTime} onChange={(e) => setCustomRecipe({ ...customRecipe, cookTime: e.target.value })} className="w-full p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400" />
                          </div>
                          <div>
                            <label className="block text-sm font-semibold mb-1 text-slate-300">Calories (optional)</label>
                            <input type="number" placeholder="e.g., 450" value={customRecipe.calories} onChange={(e) => setCustomRecipe({ ...customRecipe, calories: e.target.value })} className="w-full p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400" />
                          </div>
                          <div>
                            <label className="block text-sm font-semibold mb-1 text-slate-300">Protein (g, optional)</label>
                            <input type="number" placeholder="e.g., 35" value={customRecipe.protein} onChange={(e) => setCustomRecipe({ ...customRecipe, protein: e.target.value })} className="w-full p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400" />
                          </div>
                          <div>
                            <label className="block text-sm font-semibold mb-1 text-slate-300">Carbs (g, optional)</label>
                            <input type="number" placeholder="e.g., 48" value={customRecipe.carbs} onChange={(e) => setCustomRecipe({ ...customRecipe, carbs: e.target.value })} className="w-full p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400" />
                          </div>
                          <div>
                            <label className="block text-sm font-semibold mb-1 text-slate-300">Fat (g, optional)</label>
                            <input type="number" placeholder="e.g., 12" value={customRecipe.fat} onChange={(e) => setCustomRecipe({ ...customRecipe, fat: e.target.value })} className="w-full p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400" />
                          </div>
                        </div>

                        <div className="mb-3">
                          <label className="font-semibold block mb-2 text-slate-300">Ingredients (amount optional):</label>
                          {customRecipe.ingredients.map((ingredient, index) => (
                            <div key={index} className="flex gap-2 mb-2">
                              <input type="text" placeholder="Ingredient name" value={ingredient.name} onChange={(e) => updateCustomRecipeIngredient(index, 'name', e.target.value)} className="flex-1 p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400" />
                              <input type="number" placeholder="Amount (optional)" value={ingredient.amount} onChange={(e) => updateCustomRecipeIngredient(index, 'amount', e.target.value)} className="w-24 p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400" />
                              <select value={ingredient.unit} onChange={(e) => updateCustomRecipeIngredient(index, 'unit', e.target.value)} className="w-24 p-2 border border-slate-600 rounded bg-slate-800 text-white">
                                <option value="g">g</option>
                                <option value="ml">ml</option>
                                <option value="piece">piece</option>
                                <option value="tbsp">tbsp</option>
                                <option value="tsp">tsp</option>
                                <option value="cup">cup</option>
                                <option value="oz">oz</option>
                                <option value="lb">lb</option>
                              </select>
                              <button onClick={() => removeIngredientFromCustomRecipe(index)} className="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700">√ó</button>
                            </div>
                          ))}
                          <button onClick={addIngredientToCustomRecipe} className="mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">+ Add Ingredient</button>
                        </div>

                        <div className="mb-3">
                          <label className="font-semibold block mb-2 text-slate-300">Cooking Instructions:</label>
                          <textarea
                            placeholder="Enter step-by-step instructions (one step per line)"
                            value={customRecipe.instructions}
                            onChange={(e) => setCustomRecipe({ ...customRecipe, instructions: e.target.value })}
                            className="w-full p-3 border border-slate-600 rounded min-h-[150px] bg-slate-800 text-white placeholder-slate-400"
                          />
                        </div>

                        <div className="mb-3">
                          <label className="font-semibold block mb-2 text-slate-300">Notes (optional):</label>
                          <textarea
                            placeholder="e.g., 'Kids loved this!', 'Too spicy - reduce chili', 'Make double next time'"
                            value={customRecipe.notes}
                            onChange={(e) => setCustomRecipe({ ...customRecipe, notes: e.target.value })}
                            className="w-full p-3 border border-slate-600 rounded min-h-[80px] bg-slate-800 text-white placeholder-slate-400"
                          />
                        </div>

                        <div className="flex gap-2">
                          <button onClick={saveCustomRecipe} className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">üíæ Save Recipe</button>
                          <button onClick={() => setShowAddRecipe(false)} className="px-4 py-2 bg-slate-600 text-white rounded hover:bg-slate-500">Cancel</button>
                        </div>
                      </div>
                    )}

                    {selectedRecipe ? (
                      <div className="border border-slate-600 rounded-lg p-6 bg-slate-750">
                        <div className="mb-4 flex justify-between items-center">
                          <button
                            onClick={() => setSelectedRecipe(null)}
                            className="flex items-center gap-2 px-4 py-2 bg-slate-700 text-white rounded hover:bg-slate-600 transition"
                          >
                            ‚Üê Back to Cookbook
                          </button>
                          
                          <button
                            onClick={toggleCookMode}
                            className={`flex items-center gap-2 px-4 py-2 rounded transition ${
                              cookMode 
                                ? 'bg-green-600 text-white hover:bg-green-700' 
                                : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                          >
                            {cookMode ? '‚úì Cook Mode ON' : 'üë®‚Äçüç≥ Cook Mode'}
                          </button>
                        </div>
                        
                        <div className="flex justify-between items-start mb-4">
                          <div>
                            <h3 className={`font-bold mb-2 text-white ${cookMode ? 'text-5xl' : 'text-3xl'}`}>
                              {selectedRecipe.name}
                            </h3>
                            {selectedRecipe.url && (
                              <a href={selectedRecipe.url} target="_blank" rel="noopener noreferrer" className={`text-blue-400 hover:underline ${cookMode ? 'text-lg' : 'text-sm'}`}>
                                üîó View Original Recipe
                              </a>
                            )}
                          </div>
                        </div>

                        {/* Serving Size Scaler */}
                        {selectedRecipe.servings && (
                          <div className="mb-6 p-4 bg-slate-700 rounded-lg border border-slate-600">
                            <div className="flex items-center justify-between mb-3">
                              <label className="font-semibold text-white">Scale Recipe:</label>
                              <div className="text-sm text-slate-400">
                                Original: {selectedRecipe.servings} servings
                              </div>
                            </div>
                            <div className="flex gap-2">
                              {[1, 2, 3, 4].map(scale => {
                                const scaledServings = selectedRecipe.servings * scale;
                                return (
                                  <button
                                    key={scale}
                                    onClick={() => {
                                      const scaledRecipe = {
                                        ...selectedRecipe,
                                        displayServings: scaledServings,
                                        scale: scale,
                                        ingredients: selectedRecipe.ingredients.map(ing => ({
                                          ...ing,
                                          displayAmount: ing.amount * scale
                                        }))
                                      };
                                      setSelectedRecipe(scaledRecipe);
                                    }}
                                    className={`flex-1 px-4 py-3 rounded font-semibold transition ${
                                      (selectedRecipe.scale || 1) === scale
                                        ? 'bg-blue-600 text-white'
                                        : 'bg-slate-600 text-slate-300 hover:bg-slate-500'
                                    }`}
                                  >
                                    <div className="text-lg">{scale}x</div>
                                    <div className="text-xs">{scaledServings} servings</div>
                                  </button>
                                );
                              })}
                            </div>
                          </div>
                        )}

                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 text-center">
                          {selectedRecipe.servings && (
                            <div className="bg-slate-700 p-3 rounded border border-slate-600">
                              <div className="text-2xl font-bold text-white">{selectedRecipe.displayServings || selectedRecipe.servings}</div>
                              <div className="text-sm text-slate-400">Servings</div>
                            </div>
                          )}
                          {selectedRecipe.prepTime && (
                            <div className="bg-slate-700 p-3 rounded border border-slate-600">
                              <div className="text-lg font-bold text-white">{selectedRecipe.prepTime}</div>
                              <div className="text-sm text-slate-400">Prep Time</div>
                            </div>
                          )}
                          {selectedRecipe.cookTime && (
                            <div className="bg-slate-700 p-3 rounded border border-slate-600">
                              <div className="text-lg font-bold text-white">{selectedRecipe.cookTime}</div>
                              <div className="text-sm text-slate-400">Cook Time</div>
                            </div>
                          )}
                          {selectedRecipe.calories > 0 && (
                            <div className="bg-blue-900 p-3 rounded border border-blue-800">
                              <div className="text-2xl font-bold text-blue-300">{selectedRecipe.calories}</div>
                              <div className="text-sm text-slate-400">Calories</div>
                            </div>
                          )}
                        </div>

                        <div className="mb-6">
                          <h4 className={`font-bold mb-3 text-white ${cookMode ? 'text-3xl' : 'text-xl'}`}>
                            Ingredients
                          </h4>
                          {selectedRecipe.ingredients.length > 0 ? (
                            <ul className={`space-y-2 ${cookMode ? 'space-y-4' : ''}`}>
                              {selectedRecipe.ingredients.map((ing, index) => {
                                const displayAmount = ing.displayAmount !== undefined ? ing.displayAmount : ing.amount;
                                return (
                                  <li key={index} className={`flex items-start text-slate-300 ${cookMode ? 'text-2xl' : ''}`}>
                                    <span className={`text-blue-400 mr-2 ${cookMode ? 'text-3xl' : ''}`}>‚ñ™</span>
                                    <span>
                                      {displayAmount > 0 && `${displayAmount} ${ing.unit} `}
                                      {ing.name}
                                    </span>
                                  </li>
                                );
                              })}
                            </ul>
                          ) : (
                            <p className="text-slate-400 italic">No ingredients listed for this recipe</p>
                          )}
                        </div>

                        {selectedRecipe.instructions && (
                          <div className="mb-6">
                            <h4 className={`font-bold mb-3 text-white ${cookMode ? 'text-3xl' : 'text-xl'}`}>
                              Instructions
                            </h4>
                            <div className={`bg-slate-700 p-4 rounded instructions-text text-slate-300 border border-slate-600 ${cookMode ? 'text-2xl p-6 leading-relaxed' : ''}`}>
                              {selectedRecipe.instructions}
                            </div>
                          </div>
                        )}

                        {(selectedRecipe.protein > 0 || selectedRecipe.carbs > 0 || selectedRecipe.fat > 0) && (
                          <div className="mb-6">
                            <h4 className="font-bold text-xl mb-3 text-white">Nutrition Info</h4>
                            <div className="flex gap-3">
                              {selectedRecipe.protein > 0 && <span className="bg-green-900 px-3 py-1 rounded text-green-300 border border-green-800">Protein: {selectedRecipe.protein}g</span>}
                              {selectedRecipe.carbs > 0 && <span className="bg-yellow-900 px-3 py-1 rounded text-yellow-300 border border-yellow-800">Carbs: {selectedRecipe.carbs}g</span>}
                              {selectedRecipe.fat > 0 && <span className="bg-red-900 px-3 py-1 rounded text-red-300 border border-red-800">Fat: {selectedRecipe.fat}g</span>}
                            </div>
                          </div>
                        )}

                        {selectedRecipe.notes && (
                          <div className="mb-6">
                            <h4 className="font-bold text-xl mb-3 text-white">Notes</h4>
                            <div className="bg-yellow-900/20 border border-yellow-700 p-4 rounded text-yellow-200">
                              {selectedRecipe.notes}
                            </div>
                          </div>
                        )}

                        <div className="mt-6 pt-4 border-t border-slate-600 flex gap-2">
                          <button
                            onClick={() => editRecipe(selectedRecipe)}
                            className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                          >
                            ‚úèÔ∏è Edit Recipe
                          </button>
                          <button
                            onClick={() => deleteRecipe(selectedRecipe.id)}
                            className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
                          >
                            üóëÔ∏è Delete Recipe
                          </button>
                        </div>
                      </div>
                    ) : (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {filteredRecipes.length > 0 ? (
                          filteredRecipes.map(recipe => (
                            <div
                              key={recipe.id}
                              className="border border-slate-600 rounded-lg p-4 hover:shadow-lg transition bg-slate-750 hover:bg-slate-700 relative group"
                            >
                              <div onClick={() => setSelectedRecipe(recipe)} className="cursor-pointer">
                                <h3 className="font-bold text-lg mb-2 text-white">{recipe.name}</h3>
                                {recipe.url && (
                                  <div className="text-xs text-blue-400 mb-2 truncate">üîó Has link</div>
                                )}
                                <div className="text-sm text-slate-400 mb-2">
                                  {recipe.servings && `${recipe.servings} servings`}
                                  {recipe.prepTime && ` ‚Ä¢ ${recipe.prepTime}`}
                                  {recipe.cookTime && ` ‚Ä¢ ${recipe.cookTime}`}
                                </div>
                                <div className="text-sm mb-3">
                                  {recipe.calories > 0 && <span className="inline-block bg-blue-900 px-2 py-1 rounded mr-2 text-xs text-blue-300 border border-blue-800">{recipe.calories} cal</span>}
                                  {recipe.protein > 0 && <span className="inline-block bg-green-900 px-2 py-1 rounded mr-2 text-xs text-green-300 border border-green-800">P: {recipe.protein}g</span>}
                                  {recipe.carbs > 0 && <span className="inline-block bg-yellow-900 px-2 py-1 rounded mr-2 text-xs text-yellow-300 border border-yellow-800">C: {recipe.carbs}g</span>}
                                  {recipe.fat > 0 && <span className="inline-block bg-red-900 px-2 py-1 rounded text-xs text-red-300 border border-red-800">F: {recipe.fat}g</span>}
                                </div>
                                <div className="text-xs text-slate-500">
                                  {recipe.ingredients.length} ingredients
                                </div>
                              </div>
                              <div className="flex gap-2 mt-3 pt-3 border-t border-slate-600">
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    editRecipe(recipe);
                                  }}
                                  className="flex-1 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm"
                                >
                                  ‚úèÔ∏è Edit
                              </button>
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  deleteRecipe(recipe.id);
                                }}
                                className="flex-1 px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm"
                              >
                                üóëÔ∏è Delete
                              </button>
                            </div>
                          </div>
                        ))
                        ) : (
                          <div className="col-span-full text-center py-12">
                            <p className="text-slate-400 text-lg mb-2">No recipes found</p>
                            <p className="text-slate-500 text-sm">Try a different search term</p>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                )}

                {activeTab === 'grocery' && (
                  <div className="bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-2xl font-bold text-white">Grocery List</h2>
                      {groceryList.length > 0 && (
                        <div className="flex gap-2">
                          <button
                            onClick={exportGroceryListToReminders}
                            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm"
                          >
                            üìã Copy List
                          </button>
                          <button
                            onClick={clearAllChecks}
                            className="px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition text-sm"
                          >
                            Clear Checks
                          </button>
                        </div>
                      )}
                    </div>

                    {/* Pantry Staples Section */}
                    <div className="mb-6 p-4 bg-slate-700 rounded-lg border border-slate-600">
                      <div className="flex justify-between items-center mb-3">
                        <h3 className="font-bold text-white">Pantry Staples</h3>
                        <label className="flex items-center gap-2 text-sm text-slate-300">
                          <input
                            type="checkbox"
                            checked={filterPantryFromGrocery}
                            onChange={(e) => {
                              setFilterPantryFromGrocery(e.target.checked);
                              localStorage.setItem('filterPantryFromGrocery', JSON.stringify(e.target.checked));
                            }}
                            className="w-4 h-4 rounded"
                          />
                          Hide staples from list
                        </label>
                      </div>
                      <p className="text-sm text-slate-400 mb-3">Items you always have at home (salt, oil, etc.)</p>
                      <div className="flex gap-2 mb-3">
                        <input
                          type="text"
                          placeholder="Add staple (e.g., Salt, Olive oil)"
                          onKeyDown={(e) => {
                            if (e.key === 'Enter' && e.target.value.trim()) {
                              const newStaples = [...pantryStaples, e.target.value.trim()];
                              setPantryStaples(newStaples);
                              localStorage.setItem('pantryStaples', JSON.stringify(newStaples));
                              e.target.value = '';
                            }
                          }}
                          className="flex-1 p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400"
                        />
                      </div>
                      <div className="flex flex-wrap gap-2">
                        {pantryStaples.map((item, index) => (
                          <div key={index} className="flex items-center gap-2 px-3 py-1 bg-slate-800 border border-slate-600 rounded-full">
                            <span className="text-white text-sm">{item}</span>
                            <button
                              onClick={() => {
                                const newStaples = pantryStaples.filter((_, i) => i !== index);
                                setPantryStaples(newStaples);
                                localStorage.setItem('pantryStaples', JSON.stringify(newStaples));
                              }}
                              className="text-red-400 hover:text-red-300 font-bold"
                            >
                              √ó
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>
                    
                    {groceryList.length === 0 ? (
                      <p className="text-slate-400 text-center py-8">No meals planned yet. Add meals to generate your grocery list!</p>
                    ) : (
                      <div className="space-y-2">
                        {groceryList.map((item, index) => {
                          const itemKey = `${item.name}-${item.amount}-${item.unit}`;
                          const isChecked = checkedGroceryItems[itemKey] || false;
                          
                          return (
                            <div key={index} className={`border border-slate-600 rounded-lg p-4 bg-slate-750 transition ${isChecked ? 'opacity-50' : ''}`}>
                              <div className="flex items-start gap-3">
                                <input
                                  type="checkbox"
                                  checked={isChecked}
                                  onChange={() => toggleGroceryCheck(itemKey)}
                                  className="mt-1 w-5 h-5 rounded border-slate-500 text-blue-600 focus:ring-blue-500 focus:ring-offset-slate-800 cursor-pointer"
                                />
                                <div className="flex-1">
                                  <div className="flex items-baseline justify-between gap-3">
                                    <div className="flex items-baseline gap-3">
                                      <span className={`font-semibold text-lg text-white ${isChecked ? 'line-through' : ''}`}>
                                        {item.name}
                                      </span>
                                      {item.amount > 0 && (
                                        <span className={`text-slate-400 ${isChecked ? 'line-through' : ''}`}>
                                          {item.amount} {item.unit}
                                        </span>
                                      )}
                                    </div>
                                    {!pantryStaples.includes(item.name) && (
                                      <button
                                        onClick={() => {
                                          const newStaples = [...pantryStaples, item.name];
                                          setPantryStaples(newStaples);
                                          localStorage.setItem('pantryStaples', JSON.stringify(newStaples));
                                        }}
                                        className="px-2 py-1 bg-yellow-700 text-white rounded hover:bg-yellow-600 text-xs whitespace-nowrap"
                                        title="Add to pantry staples"
                                      >
                                        + Staple
                                      </button>
                                    )}
                                  </div>
                                  {item.details && item.details.length > 0 && (
                                    <div className="text-sm text-slate-400 mt-2 ml-4">
                                      {item.details.map((detail, i) => (
                                        <div key={i}>
                                          {detail.amount > 0 ? `+ ${detail.amount} ${detail.unit}` : '+'} (for {detail.from})
                                        </div>
                                      ))}
                                    </div>
                                  )}
                                  {item.recipes && item.recipes.length > 0 && (
                                    <div className="text-xs text-slate-500 mt-1">
                                      for: {item.recipes.join(', ')}
                                    </div>
                                  )}
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                )}

                {activeTab === 'history' && (
                  <div className="bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700">
                    <h2 className="text-2xl font-bold text-white mb-4">Meal History</h2>
                    
                    {mealHistory.length === 0 ? (
                      <div className="text-center py-12">
                        <p className="text-slate-400 text-lg mb-2">No meal history yet</p>
                        <p className="text-slate-500 text-sm">Plan a week and click "üíæ Save to History" to start tracking!</p>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        {mealHistory.map(entry => (
                          <div key={entry.id} className="border border-slate-600 rounded-lg p-4 bg-slate-750">
                            <div className="flex justify-between items-start mb-3">
                              <div>
                                <h3 className="font-bold text-lg text-white">{entry.name}</h3>
                                <p className="text-sm text-slate-400">
                                  {new Date(entry.date).toLocaleDateString('en-US', { 
                                    year: 'numeric', 
                                    month: 'long', 
                                    day: 'numeric' 
                                  })}
                                </p>
                              </div>
                              <div className="flex gap-2">
                                <button
                                  onClick={() => loadWeekFromHistory(entry)}
                                  className="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm"
                                >
                                  üì• Load
                                </button>
                                <button
                                  onClick={() => deleteHistoryEntry(entry.id)}
                                  className="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm"
                                >
                                  üóëÔ∏è
                                </button>
                              </div>
                            </div>
                            <div className="text-sm text-slate-300">
                              <span className="font-semibold">{entry.meals.length} meals planned</span>
                              {entry.meals.length > 0 && (
                                <div className="mt-2 flex flex-wrap gap-1">
                                  {entry.meals.slice(0, 5).map((meal, idx) => (
                                    <span key={idx} className="bg-slate-700 px-2 py-1 rounded text-xs">
                                      {meal.isCustom ? meal.customName : meal.recipe.name}
                                    </span>
                                  ))}
                                  {entry.meals.length > 5 && (
                                    <span className="text-slate-500 text-xs px-2 py-1">
                                      +{entry.meals.length - 5} more
                                    </span>
                                  )}
                                </div>
                              )}
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                )}

                {activeTab === 'pantry' && (
                  <div className="bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700">
                    <h2 className="text-2xl font-bold text-white mb-4">Smart Recipe Matcher</h2>
                    
                    <div className="mb-6 p-4 bg-slate-700 rounded-lg border border-slate-600">
                      <h3 className="font-bold mb-3 text-white">What do you have at home?</h3>
                      <div className="flex gap-2 mb-3">
                        <input
                          type="text"
                          placeholder="Enter ingredient (e.g., Chicken breast)"
                          value={newPantryItem}
                          onChange={(e) => setNewPantryItem(e.target.value)}
                          onKeyPress={(e) => e.key === 'Enter' && addPantryItem()}
                          className="flex-1 p-2 border border-slate-600 rounded bg-slate-800 text-white placeholder-slate-400"
                        />
                        <button
                          onClick={addPantryItem}
                          className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                        >
                          + Add
                        </button>
                      </div>
                      
                      <div className="flex flex-wrap gap-2">
                        {pantryItems.map((item, index) => (
                          <div key={index} className="flex items-center gap-2 px-3 py-1 bg-slate-800 border border-slate-600 rounded-full">
                            <span className="text-white">{item}</span>
                            <button
                              onClick={() => removePantryItem(index)}
                              className="text-red-400 hover:text-red-300 font-bold"
                            >
                              √ó
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>
                    
                    <div>
                      <h3 className="font-bold text-lg mb-3 text-white">
                        Recipe Suggestions ({matchingRecipes.length} found)
                      </h3>
                      
                      {pantryItems.length === 0 ? (
                        <p className="text-slate-400 text-center py-8">Add ingredients above to find matching recipes!</p>
                      ) : matchingRecipes.length === 0 ? (
                        <p className="text-slate-400 text-center py-8">No matching recipes found. Try adding more ingredients!</p>
                      ) : (
                        <div className="space-y-4">
                          {matchingRecipes.map(({ recipe, matchPercentage, matchingCount, missingIngredients, missingCount }) => (
                            <div key={recipe.id} className="border border-slate-600 rounded-lg p-4 hover:shadow-lg transition bg-slate-750">
                              <div className="flex justify-between items-start mb-3">
                                <div>
                                  <h4 className="font-bold text-lg text-white">{recipe.name}</h4>
                                  <div className="text-sm text-slate-400">
                                    {matchingCount}/{recipe.ingredients.length} ingredients you have
                                  </div>
                                </div>
                                <div className="text-right">
                                  <div className="text-2xl font-bold text-green-400">
                                    {Math.round(matchPercentage)}%
                                  </div>
                                  <div className="text-xs text-slate-500">match</div>
                                </div>
                              </div>
                              
                              <div className="w-full bg-slate-600 rounded-full h-2 mb-3">
                                <div className="bg-green-500 h-2 rounded-full" style={{ width: `${matchPercentage}%` }}></div>
                              </div>
                              
                              {missingCount > 0 && (
                                <div className="bg-yellow-900 p-3 rounded border border-yellow-800">
                                  <div className="font-semibold text-sm mb-2 text-yellow-300">
                                    Need to buy ({missingCount} item{missingCount > 1 ? 's' : ''}):
                                  </div>
                                  <div className="flex flex-wrap gap-2">
                                    {missingIngredients.map((ing, index) => (
                                      <span key={index} className="text-xs bg-slate-800 px-2 py-1 rounded border border-slate-600 text-white">
                                        {ing.name}
                                      </span>
                                    ))}
                                  </div>
                                </div>
                              )}
                              
                              {missingCount === 0 && (
                                <div className="bg-green-900 p-3 rounded text-green-300 font-semibold text-center border border-green-800">
                                  ‚úì You have everything to make this recipe!
                                </div>
                              )}

                              <button
                                onClick={() => {
                                  setSelectedRecipe(recipe);
                                  setActiveTab('cookbook');
                                }}
                                className="mt-3 w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                              >
                                View Recipe
                              </button>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {activeTab === 'nutrition' && (
                  <div className="bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700">
                    <h2 className="text-2xl font-bold text-white mb-4">Weekly Nutrition Overview</h2>
                    
                    {meals.length === 0 ? (
                      <p className="text-slate-400 text-center py-8">No meals planned yet. Add meals to see nutrition stats!</p>
                    ) : (
                      <div className="space-y-6">
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                          <div className="bg-blue-900 p-6 rounded-lg text-center border border-blue-800">
                            <div className="text-3xl font-bold text-blue-300">{nutrition.calories}</div>
                            <div className="text-slate-400">Total Calories</div>
                          </div>
                          <div className="bg-green-900 p-6 rounded-lg text-center border border-green-800">
                            <div className="text-3xl font-bold text-green-300">{nutrition.protein}g</div>
                            <div className="text-slate-400">Protein</div>
                          </div>
                          <div className="bg-yellow-900 p-6 rounded-lg text-center border border-yellow-800">
                            <div className="text-3xl font-bold text-yellow-300">{nutrition.carbs}g</div>
                            <div className="text-slate-400">Carbs</div>
                          </div>
                          <div className="bg-red-900 p-6 rounded-lg text-center border border-red-800">
                            <div className="text-3xl font-bold text-red-300">{nutrition.fat}g</div>
                            <div className="text-slate-400">Fat</div>
                          </div>
                        </div>

                        <div className="bg-slate-700 p-4 rounded-lg border border-slate-600">
                          <h3 className="font-bold mb-3 text-white">Daily Average (based on {meals.length} meals)</h3>
                          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                              <div className="font-semibold text-white">{Math.round(nutrition.calories / 7)} cal/day</div>
                              <div className="text-sm text-slate-400">Calories</div>
                            </div>
                            <div>
                              <div className="font-semibold text-white">{Math.round(nutrition.protein / 7)}g/day</div>
                              <div className="text-sm text-slate-400">Protein</div>
                            </div>
                            <div>
                              <div className="font-semibold text-white">{Math.round(nutrition.carbs / 7)}g/day</div>
                              <div className="text-sm text-slate-400">Carbs</div>
                            </div>
                            <div>
                              <div className="font-semibold text-white">{Math.round(nutrition.fat / 7)}g/day</div>
                              <div className="text-sm text-slate-400">Fat</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                )}

                {activeTab === 'help' && (
                  <div className="bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700">
                    <h2 className="text-2xl font-bold text-white mb-6">Help & Setup Guide</h2>

                    {/* Apple Shortcuts Setup */}
                    <div className="mb-8 p-4 bg-blue-900/20 border border-blue-700 rounded-lg">
                      <h3 className="font-bold text-blue-300 mb-4 text-xl">üì± Apple Reminders Integration</h3>
                      
                      <div className="text-sm text-slate-300 space-y-4">
                        <div>
                          <strong className="text-green-300 text-lg">‚ú® Mac Shortcuts Method (WORKS!):</strong>
                          <p className="text-slate-400 mt-2 mb-3">One-time setup, then 2-click automation every week!</p>
                          
                          <ol className="list-decimal ml-5 mt-2 space-y-2 text-slate-400">
                            <li>Open <strong>Shortcuts</strong> app on Mac</li>
                            <li>Click <strong>+</strong> to create new Shortcut</li>
                            <li>Add action: <strong>Get Clipboard</strong></li>
                            <li>Add action: <strong>Split</strong> (set to split by "New Lines")</li>
                            <li>Add action: <strong>Repeat with Each</strong>
                              <ul className="ml-4 mt-1">
                                <li>‚Ä¢ Input should be: <strong>Split Text</strong></li>
                              </ul>
                            </li>
                            <li><strong className="text-yellow-300">‚ö†Ô∏è CRITICAL:</strong> Add action: <strong>Add</strong> (adds to reminders list)
                              <ul className="ml-4 mt-1 space-y-1">
                                <li>‚Ä¢ Click the input field ‚Üí Select <strong>"Repeat Item"</strong> variable</li>
                                <li>‚Ä¢ Should read: <strong>Add [Repeat Item] to [Your List Name]</strong></li>
                                <li>‚Ä¢ If it says "Add [currentItem] Item to..." ‚Üê DELETE the word "Item"!</li>
                                <li>‚Ä¢ Set list name to your actual "Groceries" list</li>
                              </ul>
                            </li>
                            <li>Add action: <strong>End Repeat</strong></li>
                            <li>Name it "Import Grocery List" and save!</li>
                          </ol>
                        </div>

                        <div className="p-3 bg-green-900/20 rounded border border-green-700">
                          <strong className="text-green-300">üéØ Weekly Usage:</strong>
                          <ol className="list-decimal ml-5 text-slate-400 mt-2 space-y-1">
                            <li>Plan your meals in the Planner tab</li>
                            <li>Go to Grocery tab ‚Üí Click <strong>"üìã Copy List"</strong></li>
                            <li>Run your <strong>"Import Grocery List"</strong> shortcut</li>
                            <li>‚úÖ All items added to Apple Reminders!</li>
                          </ol>
                        </div>

                        <div className="p-3 bg-red-900/20 border border-red-700 rounded">
                          <p className="text-xs text-red-300 font-bold">‚ö†Ô∏è TROUBLESHOOTING:</p>
                          <p className="text-xs text-slate-400 mt-2">
                            If you see "Repeat Item" instead of actual groceries:
                          </p>
                          <ul className="ml-5 text-xs text-slate-400 mt-1 list-disc">
                            <li>Make sure the Add action uses <strong>"Repeat Item"</strong> variable, not "Split Text"</li>
                            <li>Click "Copy List" FIRST, then immediately run Shortcut</li>
                            <li>Delete any extra "Item" text in the Add action</li>
                          </ul>
                        </div>

                        <details className="text-sm">
                          <summary className="cursor-pointer hover:text-slate-300 text-blue-300">Manual method (if Shortcuts doesn't work)</summary>
                          <ol className="list-decimal ml-5 mt-2 space-y-1 text-slate-400">
                            <li>Click "üìã Copy List" in Grocery tab</li>
                            <li>Open Reminders app ‚Üí your "Groceries" list</li>
                            <li>Cmd+V ‚Üí Return ‚Üí Cmd+V ‚Üí Return (repeat for each item)</li>
                          </ol>
                        </details>
                      </div>
                    </div>

                    {/* App Features */}
                    <div className="space-y-6">
                      <div>
                        <h3 className="font-bold text-white text-lg mb-3">üìö Feature Guide</h3>
                        <div className="grid gap-4 md:grid-cols-2">
                          <div className="bg-slate-700 p-4 rounded border border-slate-600">
                            <h4 className="font-bold text-blue-300 mb-2">üìÖ Planner</h4>
                            <ul className="text-sm text-slate-400 space-y-1 list-disc ml-4">
                              <li>Type meal names or select from cookbook</li>
                              <li>Quick options: Leftovers, Eating Out, Frozen Pizza</li>
                              <li>Custom meals don't add to grocery list</li>
                              <li><strong>Kids row:</strong> Plan separate kid meals (Nuggets while adults eat Curry)</li>
                              <li>Leave Kids row empty if everyone eats the same</li>
                              <li>Save weeks to History for later reuse</li>
                            </ul>
                          </div>
                          
                          <div className="bg-slate-700 p-4 rounded border border-slate-600">
                            <h4 className="font-bold text-blue-300 mb-2">üìñ Cookbook</h4>
                            <ul className="text-sm text-slate-400 space-y-1 list-disc ml-4">
                              <li>Add recipes manually or import from URL</li>
                              <li>Search by name, ingredient, or instruction</li>
                              <li>Ingredients optional (good for frozen meals)</li>
                              <li>Add notes: "Kids loved this!", "Too spicy"</li>
                            </ul>
                          </div>
                          
                          <div className="bg-slate-700 p-4 rounded border border-slate-600">
                            <h4 className="font-bold text-blue-300 mb-2">üõí Grocery</h4>
                            <ul className="text-sm text-slate-400 space-y-1 list-disc ml-4">
                              <li>Auto-generated from planned meals</li>
                              <li>Click "+ Staple" to mark items you always have</li>
                              <li>Checkboxes for online ordering</li>
                              <li>Copy to Apple Reminders for in-store shopping</li>
                            </ul>
                          </div>
                          
                          <div className="bg-slate-700 p-4 rounded border border-slate-600">
                            <h4 className="font-bold text-blue-300 mb-2">üìú History</h4>
                            <ul className="text-sm text-slate-400 space-y-1 list-disc ml-4">
                              <li>Save favorite weeks for easy replanning</li>
                              <li>Load past weeks into current planner</li>
                              <li>Track seasonal meal patterns</li>
                              <li>Remember what worked well</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MealPlannerApp />);
    </script>
</body>
</html>
